openapi: "3.1.0"
info:
  title: IWXXM METAR/SPECI Observation Model
  version: "1.0"
  description: |
    An OpenAPI model of the IWXXM METAR/SPECI Observation diagram.

components:
  schemas:
    MeteorologicalAerodromeObservation:
      description: Meteorological conditions observed at an aerodrome.
      type: object
      required:
        - airTemperature
        - dewpointTemperature
        - qnh
        - surfaceWind
      properties:
        airTemperature:
          $ref: "../Common/Measure.yaml#/components/schemas/MeasureWithNilReason"
        dewpointTemperature:
          $ref: "../Common/Measure.yaml#/components/schemas/MeasureWithNilReason"
        qnh:
          $ref: "../Common/Measure.yaml#/components/schemas/MeasureWithNilReason"
        surfaceWind:
          $ref: "#/components/schemas/AerodromeSurfaceWind"
        visibility:
          $ref: "#/components/schemas/AerodromeHorizontalVisibility"
        rvr:
          type: array
          uniqueItems: true
          items:
            $ref: "#/components/schemas/AerodromeRunwayVisualRange"
        presentWeather:
          type: array
          maxItems: 3
          uniqueItems: true
          items:
            $ref: "Weather.yaml#/components/schemas/AerodromePresentWeather"
        cloud:
          $ref: "#/components/schemas/AerodromeCloud"
        recentWeather:
          type: array
          maxItems: 3
          uniqueItems: true
          items:
            $ref: "Weather.yaml#/components/schemas/AerodromeRecentWeather"
        windShear:
          $ref: "#/components/schemas/AerodromeWindShear"
        seaCondition:
          $ref: "#/components/schemas/AerodromeSeaCondition"
        cloudAndVisibilityOK:
          type: string
          enum: ["CAVOK"]

    AerodromeSurfaceWindWithNilReason:
      allOf:
        - $ref: "#/components/schemas/AerodromeSurfaceWind"
        - $ref: "../Common/Measure.yaml#/components/schemas/NilReason"

    AerodromeSurfaceWind:
      description: An aggregation of surface wind conditions typically reported together at an aerodrome, including wind direction information, wind speed, and wind gusts.
      type: object
      required:
        - meanWindSpeed
      properties:
        meanWindDirection:
          description: http://codes.wmo.int/common/quantity-kind/windDirection
          $ref: "../Common/Measure.yaml#/components/schemas/AngleWithNilReason"
        meanWindSpeed:
          description: http://codes.wmo.int/common/quantity-kind/windSpeed
          $ref: "../Common/Measure.yaml#/components/schemas/VelocityWithNilReason"
        meanWindSpeedOperator:
          $ref: "../Common/Relational_Operator.yaml#/components/schemas/RelationalOperator"
        windGustSpeed:
          description: http://codes.wmo.int/common/quantity-kind/maximumWindGustSpeed
          $ref: "../Common/Measure.yaml#/components/schemas/VelocityWithNilReason"
        windGustSpeedOperator:
          $ref: "../Common/Relational_Operator.yaml#/components/schemas/RelationalOperator"
        extremeClockwiseWindDirection:
          description: http://codes.wmo.int/common/quantity-kind/windDirection
          $ref: "../Common/Measure.yaml#/components/schemas/AngleWithNilReason"
        extremeCounterClockwiseWindDirection:
          description: http://codes.wmo.int/common/quantity-kind/windDirection
          $ref: "../Common/Measure.yaml#/components/schemas/AngleWithNilReason"
        variableWindDirection:
          type: string
          enum: ["VRB"]

    AerodromeHorizontalVisibility:
      description: An aggregation of horizontal visibility conditions typically reported together at an aerodrome, including the prevailing visibility and minimum visibility.
      type: object
      required:
        - prevailingVisibility
      properties:
        prevailingVisibility:
          description: http://codes.wmo.int/common/quantity-kind/aeronauticalPrevailingHorizontalVisibility
          $ref: "../Common/Measure.yaml#/components/schemas/DistanceWithNilReason"
        prevailingVisibilityOperator:
          $ref: "../Common/Relational_Operator.yaml#/components/schemas/RelationalOperator"
        minimumVisibility:
          description: http://codes.wmo.int/common/quantity-kind/aeronauticalVisibility
          $ref: "../Common/Measure.yaml#/components/schemas/DistanceWithNilReason"
        minimumVisibilityDirection:
          description: http://codes.wmo.int/common/quantity-kind/aerodromeMinimumVisibilityDirection
          $ref: "../Common/Measure.yaml#/components/schemas/AngleWithNilReason"

    AerodromeRunwayVisualRange:
      description: An aggregation of runway visual range conditions for a single runway, typically reported together at an aerodrome.
      type: object
      required:
        - runway
        - meanRVR
      properties:
        runway:
          $ref: "../AIXM/AIXM.yaml#/components/schemas/RunwayDirection"
        meanRVR:
          description: http://codes.wmo.int/common/quantity-kind/runwayVisualRangeRvr
          $ref: "../Common/Measure.yaml#/components/schemas/DistanceWithNilReason"
        meamRVROperator:
          $ref: "../Common/Relational_Operator.yaml#/components/schemas/RelationalOperator"
        pastTendency:
          $ref: "#/components/schemas/VisualRangeTendency"

    AerodromeCloud:
      description: An aggregation of observed cloud conditions typically reported together at an aerodrome, including cloud types, cloud layers, and vertical visibility.
      type: object
      properties:
        verticalVisibility:
          description: http://codes.wmo.int/common/quantity-kind/verticalVisibility
          $ref: "../Common/Measure.yaml#/components/schemas/LengthWithNilReason"
        layer:
          type: array
          maxItems: 4
          uniqueItems: true
          items:
            $ref: "../Common/Cloud.yaml#/components/schemas/CloudLayer"

    AerodromeWindShear:
      description: An aggregation of wind shear conditions typically reported together at an aerodrome, including the set of affected runways.
      type: object
      properties:
        runway:
          type: array
          uniqueItems: true
          items:
            $ref: "../AIXM/AIXM.yaml#/components/schemas/RunwayDirection"
        allRunways:
          type: string
          enum: ["All"]

    AerodromeSeaCondition:
      description: An aggregation of sea state conditions typically reported together at an aerodrome.
      type: object
      required:
        - seaSurfaceTemperature
      properties:
        seaSurfaceTemperature:
          description: http://codes.wmo.int/common/quantity-kind/seaSurfaceTemperature
          $ref: "../Common/Measure.yaml#/components/schemas/MeasureWithNilReason"
        significantWaveHeight:
          $ref: "../Common/Measure.yaml#/components/schemas/DistanceWithNilReason"
        seaState:
          $ref: "SeaSurface_State.yaml#/components/schemas/SeaSurfaceState"

    VisualRangeTendency:
      description: The tendency of visual range (e.g., upward, downward).
      type: string
      enum: ["UPWARD", "NO_CHANGE", "DOWNWARD", "MISSING_VALUE"]
